--- 
layout: default
title: Converting An ASP.NET Web Forms Project To ASP.NET MVC
---
<p>Continuing with my last post about the differences between Web Site projects and Web Application projects in ASP.NET, this post details how I converted a legacy ASP.NET Web Site project to an ASP.NET MVC project (a variant of a Web Application project).</p>
<h4>Getting Started&hellip; ASP.NET MVC?</h4>
<p>I originally intended to only convert the project to a web application. I ran into a couple scenarios during development in which I wanted the capabilities that a Web Application project offers over a Web Site. See my <a href="/post/ASPNET-Web-Sites-Versus-Web-Applications.aspx">previous post</a> for some of these differences.</p>
<p>However, when I started looking into the conversion process, I decided to jump ahead and convert to the ASP.NET MVC framework.</p>
<p>Why jump to ASP.NET MVC? I had been keeping an eye on the development of the ASP.NET team&rsquo;s MVC framework (an alternative to the existing ASP.NET Web Forms model) and liked the direction it was headed. I had experimented with Ruby on Rails (probably the most well-known web MVC framework), and liked the clean separation of concerns, more natural model of web development (as opposed to the leaky abstractions of ASP.NET Web Forms), etc.</p>
<p>I knew it wasn&rsquo;t realistic to convert all pages in the existing project to new MVC ones. However, since it&rsquo;s possible to run regular Web Forms inside of MVC projects, this seemed like a good compromise to preserve legacy code while using the MVC paradigm for future work. The MVC project type is a specialized version of a Web Application Project, and current Web Forms page, even in an MVC project, can still be processed as usual since the underlying ASP.NET engine is the same for Web Forms and MVC applications.</p>
<h4>Steps and Caveats</h4>
<p>I began by installing the ASP.NET MVC installer, which installs the MVC library DLLs into the GAC as well as the ASP.NET MVC Visual Studio project types and templates, and creating a new ASP.NET MVC project. I then started copying files from the old to the new project.</p>
<p>There's a decent walkthrough <a href="http://msdn.microsoft.com/en-us/library/bb907624.aspx">here</a> (the guide is for Web Application projects, but it was close to what I needed). Still, I was greeted with over 5,000 build errors after following the official directions and trying to build the project for the first time. I found I needed to take things slower and at a more granular level, transferring a few files at a time to the new project and evaluating the differences one by one.</p>
<p>I transferred several settings from the web site&rsquo;s web.config appSettings section to settings in the Visual Studio project settings file (right click on project &ndash;&gt; Properties &ndash;&gt; Settings). This more closely follows the standard way of managing settings using Visual Studio project files, and also performs code generation to create strongly-typed properties automatically. These settings are still stored in the web.config file (so they can be changed while the web application is running), but they&rsquo;re stored under a slightly different schema for project file properties.</p>
<p>The mechanisms for references to web services is different in Web Application projects versus Web Sites, but this is fairly straightforward as I just re-added all my references (although this might take time if you have many references).</p>
<p>I love ReSharper, but I had to shush it during the conversion process to avoid being nagged to death by premature warnings and code analysis.</p>
<p>Something to keep in mind is that the automatically generated designer files for Web Application project aspx pages are automatically re-generated when aspx files are saved. This means that when you adjust the namespace in the aspx file (e.g. with an Inherits="C4IFACT.App.WebForms.ExecutionPlans" attribute on the Page directive) then it is reflected in the designer file. I was getting many perturbing error messages about incorrect namespaces that were resolved by this (since the aspx page and designer files can temporarily get out of sync at times).</p>
<p>While there is some level of security from static typing and having your project "compiled" into a DLL, you should remember that an ASP.NET project has a DLL for all of the plain C# code supporting the application, but the aspx pages are not compiled when a project is built, but instead reference types in the project&rsquo;s assembly and are executed by the ASP.NET runtime when a page is visited. This means that you might still have compile errors in aspx files that won&rsquo;t be reflected in the build. To help this, you can flip a switch on your MVC project to trigger the ASP.NET compiler to compile ASP.NET markup and code inside aspx pages on project compile (see <a href="http://stackoverflow.com/questions/383192/compile-views-in-asp-net-mvc">here</a> for directions on doing this &ndash; it even works against Web Forms pages if you have some mixed in with your MVC project). However, this affects the performance of building the MVC project significantly.</p>
<h4>Organization and Folder Structure</h4>
<p>While trying to respect the default conventions of ASP.NET MVC, I also looked at Rob Conery's <a href="http://blog.wekeroad.com/blog/my-mvc-starter-template/">enhanced version</a> and also the Rails <a href="http://www.tutorialspoint.com/ruby-on-rails/rails-directory-structure.htm">folder structure</a>.</p>
<p>While creating my folder structure, I thought about re-structuring parts of the old app and creating clean namespaces. I settled on this:</p>
<p><img style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" title="MVC Folder Structure" src="/images/WindowsLiveWriter/ConvertingAnASP.NETWebFormToAnMVCPage/6B2675BE/MVCFolderStructure_thumb.png" border="0" alt="MVC Folder Structure" width="156" height="342" /></p>
<ul>
<li>The App folder contains most executable content (following the Rails convention). MVC controllers and views are here. </li>
<li>The App\Helpers folder contains former App_Code files and miscellaneous utility classes. </li>
<li>I have a separate project in the solution containing data access code and models, so I don&rsquo;t have a strict folder for models. However, I have a ViewModels folder, where model classes tailored specifically for presenting view logic or data binding are. </li>
<li>Master Pages and User Controls (Partials) are under Views\Shared. </li>
<li>I wanted to put my Web Forms into the Views folder (even though they aren't true Views), but there seems to be a hard setting in ASP routing that doesn't serve anything from the Views folder, so I placed them into a separate WebForms folder. I could have also routed Web Forms pages to friendler URLs (using the routing portion of the MVC framework), but for now I kept things simple and used the physical location (e.g. &ldquo;MyPage.aspx&rdquo; is accessed at &ldquo;www.mysite.com/app/webforms/mypage.aspx&rdquo;). </li>
<li>The Assemblies folder contains third-party, referenced assemblies (those not contained in the GAC). Note that things under here should be referenced in the project, but should also be set to Content and not be copied to the project's build output location so that they won't be included with the project output as content (although they will be included as necessary along with the project's built DLL in the published folder). </li>
<li>The Public contains static content divided into Images, Stylesheets, and JavaScripts folders. </li>
</ul>
<h4>CodeFile Versus CodeBehind</h4>
<p>One last point - Web Site project "CodeFile" directives should be "CodeBehind" in Web Application / MVC projects. I found a great tip in the comments from <a href="http://aspadvice.com/blogs/ssmith/archive/2007/01/24/CodeFile-or-CodeBehind.aspx">this</a> post about possible confusion that can result when converting from Web Site to Web Application projects. Here's an excerpt from the comment:</p>
<blockquote>The issue with CodeFile is that the code is compiled into its own (or directory level assembly) and so the type may not be available to another page unless the control is @Registered. If you dynamically load you pretty much can't reference the ASCX codebehind class. With WAP everything goes into a single assembly so you can reference the codebehind class from just about anywhere... The thing is that if you forget to set the proper format for WAP code the page/control will still work because ASP.NET internally doesn't care whether a project is stock or WAP so the page/control runs just fine with CodeFile.</blockquote>
<p>This hit upon a frustrating problem I ran into: my user controls were being compiled into their own separate assembly because I left them using the CodeFile attribute, so when I tried to import the user control (with its custom server tag) globally via the web.config (as <a href="http://weblogs.asp.net/scottgu/archive/2006/11/26/tip-trick-how-to-register-user-controls-and-custom-controls-in-web-config.aspx">this</a> tip suggests) and I just referred to what I thought was the correct namespace I had problems because <strong>the user control was being compiled automagically into a separate assembly where CodeFiles are compiled</strong>.</p>
<p>The "Convert to Web Application" context menu for aspx pages is supposed to handle this for you and change CodeFile directives to CodeBehind, but I had issues with several pages where this didn't work and I didn't realize it for awhile. Even still, this action doesn't handle namespaces for you and still accepts the Web Site-style "Folder1_Folder2_ClassName" unique name approach instead of conventional .Net class library "Folder1.Folder2.ClassName" namespaces (how I preferred things). Basically, adjusting namespaces properly ending up involving a lot of manual work, as simply copying files and clicking "Convert to Web Application" doesn't adjust namespaces properly even if you put the files in the conventional folders.</p>
